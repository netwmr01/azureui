{
    "handler": "Microsoft.Compute.MultiVm",
    "version": "0.0.1-preview",
    "parameters": {
        "basics": [
            {
                "name": "username",
                "type": "Microsoft.Compute.UserNameTextBox",
                "label": "Linux Username",
                "toolTip": "Username for linux virtual machine",
                "constraints": {
                    "required": true
                },
                "osPlatform": "Linux"
            },
            {
                "name": "password",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                    "password": "Linux password",
                    "confirmPassword": "Confirm password"
                },
                "toolTip": "Password for the linux virtual machine.",
                "constraints": {
                    "required": true,
                    "regex": "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{6,72}$",
                    "validationMessage": "The password must be between 6 and 72 characters long, and contain characters from at least 3 of the following groups: uppercase characters, lowercase characters, numbers, and special characters."
                },
                "options": {
                    "hideConfirmation": false
                }
            }
        ],
        "steps":
        [
            {
                "name": "infraInfo",
                "label": "Infrastructure information",
                "subLabel": {
                    "preValidation": "Provide infrastructure information",
                    "postValidation": "Done"
                },
                "bladeTitle": "Infrastructure information",
                "elements":
                [
                    {
                        "name": "DNSPrefix",
                        "type": "Microsoft.Network.PublicIpAddressCombo",
                        "label": {
                            "publicIpAddress": "Resource name for this IP prefix",
                            "domainNameLabel": "Domain name prefix Director Server"
                        },
                        "toolTip": {
                            "publicIpAddress": "Only new public IP is currently supported",
                            "domainNameLabel": "Cloudera Director will be accessible from port 7189"
                        },
                        "defaultValue": {
                            "publicIpAddressName": "public_ip",
                            "domainNameLabel": "change_me_to_be_unique"
                        },
                        "constraints": {
                            "required": true
                        },
                        "options": {
                            "hideNone": true,
                            "hideDomainNameLabel": false
                        }
                    },
                    {
                        "name": "dnsNameSuffix",
                        "type": "Microsoft.Common.TextBox",
                        "label": "DNS suffix ",
                        "toolTip": "This suffix is used internally within the vnet",
                        "constraints": {
                            "required": true
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "directorVmSize",
                        "type": "Microsoft.Compute.SizeSelector",
                        "label": "Master VM size",
                        "defaultValue": "Standard_DS12_v2",
                        "toolTip": "The size of virtual machine for director server. Please choose a location that currently supports premium storage.",
                        "osPlatform": "Linux",
                        "recommendedSizes": [
                            "Standard_DS14"
                        ],
                        "constraints": {
                            "required": true,
                            "allowedSizes": [
                                "Standard_DS13",
                                "Standard_DS14",
                                "Standard_DS12_v2",
                                "Standard_DS13_v2",
                                "Standard_DS14_v2"
                            ]
                        },
                        "imageReference": {
                            "publisher": "cloudera",
                            "offer": "cloudera-centos-6",
                            "sku": "CLOUDERA-CENTOS-6"
                        }
                    },
                    {
                        "name": "vnetSpec",
                        "type": "Microsoft.Network.VirtualNetworkCombo",
                        "label": {
                            "virtualNetwork": "Virtual network",
                            "subnets": "Subnets"
                        },
                        "toolTip": {
                            "virtualNetwork": "",
                            "subnets": ""
                        },
                        "defaultValue": {
                            "name": "clouderaVnet",
                            "addressPrefixSize": "/16"
                        },
                        "constraints": {
                            "minAddressPrefixSize": "/29"
                        },
                        "subnets": {
                            "subnet1": {
                                "label": "Cloudera subnet",
                                "defaultValue": {
                                    "name": "default",
                                    "addressPrefixSize": "/16"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/29",
                                    "minAddressCount": 2,
                                    "requireContiguousAddresses": true
                                }
                            }
                        }
                     },
                     {
                        "name": "dirUsername",
                        "type": "Microsoft.Compute.UserNameTextBox",
                        "label": "Director Username",
                        "toolTip": "Username for Director.",
                        "constraints": {
                            "required": true
                        },
                        "osPlatform": "Linux"
                    },
                    {
                        "name": "dirPassword",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Director Password",
                            "confirmPassword": "Confirm password"
                        },
                        "toolTip": "Password for Director.",
                        "constraints": {
                            "required": true,
                            "regex": "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{6,72}$",
                            "validationMessage": "The password must be between 6 and 72 characters long, and contain characters from at least 3 of the following groups: uppercase characters, lowercase characters, numbers, and special characters."
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "dbUsername",
                        "type": "Microsoft.Compute.UserNameTextBox",
                        "label": "DB Username",
                        "toolTip": "Username for DB server used by Director.",
                        "constraints": {
                            "required": true
                        },
                        "osPlatform": "Linux"
                    },
                    {
                        "name": "dbPassword",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "DB Password",
                            "confirmPassword": "Confirm password"
                        },
                        "toolTip": "Password for DB server used by Director.",
                        "constraints": {
                            "required": true,
                            "regex": "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{6,72}$",
                            "validationMessage": "The password must be between 6 and 72 characters long, and contain characters from at least 3 of the following groups: uppercase characters, lowercase characters, numbers, and special characters."
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    }
                ]
            },
            {"name": "clouderaSetupInformation",
                "label": "Cloudera setup information",
                "subLabel": {
                    "preValidation": "Provide Cloudera setup information",
                    "postValidation": "Done"
                },
                "bladeTitle": "Cloudera Director setup information",
                "elements":
                [
                    {
                        "name": "directorEnvironmentName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Environment Name to be used by Director",
                        "toolTip": "Environment Name to be used by Director",
                        "constraints": {
                            "required": true
                        }
                    },
                    {
                        "name": "subscriptionId",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Subscription ID to be used by Director",
                        "toolTip": "Subscription ID to be used by Director",
                        "constraints": {
                            "required": true,
                            "regex": "^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}",
                            "validationMessage": "The subscription must be a valid UUID"
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "tenantId",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Tenant ID to be used by Director",
                        "toolTip": "Tenant ID to be used by Director",
                        "constraints": {
                            "required": true,
                            "regex": "^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}",
                            "validationMessage": "The tenant ID must be a valid UUID"
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "clientId",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Client ID to be used by Director",
                        "toolTip": "Client ID to be used by Director",
                        "constraints": {
                            "required": true,
                            "regex": "^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}",
                            "validationMessage": "The client ID must be a valid UUID"
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "clientSecret",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Client Secret",
                            "confirmPassword": "Confirm Client Secret"
                        },
                        "toolTip": "client Secret ID to be used by Director",
                        "constraints": {
                            "required": true,
                            "regex": "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{6,72}$",
                            "validationMessage": "The password must be between 6 and 72 characters long, and contain characters from at least 3 of the following groups: uppercase characters, lowercase characters, numbers, and special characters."
                        },
                        "options": {
                            "hideConfirmation": true
                        }
                    },
                    {
                        "name": "privateKey",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Private Key",
                            "confirmPassword": "Confirm Client Secret"
                        },
                        "toolTip": "Private key to be used by Director",
                        "constraints": {
                            "required": true,
                            "validationMessage": "The subscription must be a valid UUID"
                        },
                        "options": {
                            "hideConfirmation": true
                        }
                    },
                    {
                        "name": "passPhrase",
                        "type": "Microsoft.Common.PasswordBox",
                        "label": {
                            "password": "Passphrase to decode private key",
                            "confirmPassword": "Confirm Passphrase"
                        },
                        "toolTip": "leave it blank if not needed",
                        "constraints": {
                            "required": false
                        },
                        "options": {
                            "hideConfirmation": true
                        }
                    }

                ]
            },
            {
                "name": "userInformation",
                "label": "User information",
                "subLabel": {
                    "preValidation": "Provide user information",
                    "postValidation": "Done"
                },
                "bladeTitle": "User information",
                "elements": [
                     {
                        "name": "company",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Company",
                        "toolTip": "Provide the company you are with",
                        "constraints": {
                            "required": true,
                            "regex": "",
                            "validationMessage": ""
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "emailAddress",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Email address",
                        "toolTip": "Provide your email address in the format user@site.com",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",
                            "validationMessage": "Please provide a valid email address"
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "businessPhone",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Business Phone",
                        "toolTip": "Provide your business phone number, digits only",
                        "constraints": {
                            "required": true,
                            "regex": "^[0-9]+$",
                            "validationMessage": "please input digits only, no space, - or ()"
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "firstName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "First name",
                        "toolTip": "Provide your first name.",
                        "constraints": {
                            "required": true,
                            "regex": "",
                            "validationMessage": ""
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "lastName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Last name",
                        "toolTip": "Provide your last name.",
                        "constraints": {
                            "required": true,
                            "regex": "",
                            "validationMessage": ""
                        },
                        "options": {
                            "hideConfirmation": false
                        }
                    },
                    {
                        "name": "jobRole",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Job role",
                        "toolTip": "Select your job role from dropdown box.",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                { "label": "Administrator", "value": "Administrator"},
                                { "label": "Analyst (Industry/Finance)", "value": "Analyst (Industry/Finance)"},
                                { "label": "Analyst (Technical)", "value": "Analyst (Technical)"},
                                { "label": "Architect", "value": "Architect"},
                                { "label": "C level", "value": "C level"},
                                { "label": "Consultant", "value": "Consultant"},
                                { "label": "Developer", "value": "Developer"},
                                { "label": "Director", "value": "Director"},
                                { "label": "Engineer", "value": "Engineer"},
                                { "label": "Individual contributor", "value": "Individual contributor"},
                                { "label": "Manager", "value": "Manager"},
                                { "label": "Partner", "value": "Partner"},
                                { "label": "Student", "value": "Student"},
                                { "label": "VP", "value": "VP"}
                            ]
                        }
                    },
                    {
                        "name": "jobFunction",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Job function",
                        "toolTip": "Select your job function from dropdown box.",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                { "label": "Analytics / Business Intelligence", "value": "Analytics / Business Intelligence"},
                                { "label": "Big Data / Architecture", "value": "Big Data / Architecture"},
                                { "label": "Data Warehouse / Management", "value": "Data Warehouse / Management"},
                                { "label": "Data Science", "value": "Data Science"},
                                { "label": "Database", "value": "Database"},
                                { "label": "ETL / ELT", "value": "ETL / ELT"},
                                { "label": "Infrastructure", "value": "Infrastructure"},
                                { "label": "IT", "value": "IT"},
                                { "label": "Marketing / Sales", "value": "Marketing / Sales"},
                                { "label": "Networking", "value": "Networking"},
                                { "label": "Manager", "value": "Manager"},
                                { "label": "Security / Compliance", "value": "Security / Compliance"},
                                { "label": "Storage", "value": "Storage"}
                            ]
                        }
                    }
                    ]
            }
        ],
        "outputs": {
            "adminUserName": "[basics('username')]",
            "adminPassword": "[basics('password')]",
            "dirUsername": "[steps('infraInfo').dirUsername]",
            "dirPassword": "[steps('infraInfo').dirPassword]",
            "dbUsername": "[steps('infraInfo').dbUsername]",
            "dbPassword": "[steps('infraInfo').dbPassword]",
            "subscriptionId":"[steps('clouderaSetupInformation').subscriptionId]",
            "tenantId":"[steps('clouderaSetupInformation').tenantId]",
            "clientId":"[steps('clouderaSetupInformation').clientId]",
            "clientSecret":"[steps('clouderaSetupInformation').clientSecret]",
            "passPhrase":"[steps('clouderaSetupInformation').passPhrase]",
            "privateKey":"[steps('clouderaSetupInformation').privateKey]",
            "directorSize":"[steps('infraInfo').directorVmSize]",
            "masterType":"[steps('infraInfo').masterVmSize]",
            "workerType":"[steps('infraInfo').workerVmSize]",
            "edgeType":"[steps('infraInfo').edgeVmSize]",
            "directorEnvironmentName":"[steps('clouderaSetupInformation').directorEnvironmentName]",
            "dnsNamePrefix": "[steps('infraInfo').DNSPrefix.domainNameLabel]",
            "dnsNameSuffix": "[steps('infraInfo').dnsNameSuffix]",
            "virtualNetworkName":"[steps('infraInfo').vnetSpec.name]",
            "vnetNewOrExisting": "[steps('infraInfo').vnetSpec.newOrExisting]",
            "virtualNetworkRGName": "[steps('infraInfo').vnetSpec.resourceGroup]",
            "subnetName":"[steps('infraInfo').vnetSpec.subnets.subnet1.name]",
            "addressPrefix": "[steps('infraInfo').vnetSpec.addressPrefix]",
            "subnetPrefix": "[steps('infraInfo').vnetSpec.subnets.subnet1.addressPrefix]",
            "directorServerIPAddress": "[steps('infraInfo').vnetSpec.subnets.subnet1.startAddress]",
           
            "company": "[steps('userInformation').company]",
            "emailAddress": "[steps('userInformation').emailAddress]",
            "businessPhone": "[steps('userInformation').businessPhone]",
            "firstName": "[steps('userInformation').firstName]",
            "lastName": "[steps('userInformation').lastName]",
            "jobRole": "[steps('userInformation').jobRole]",
            "jobFunction": "[steps('userInformation').jobFunction]"

        }
    }
}